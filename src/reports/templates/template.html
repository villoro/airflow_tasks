{% extends "base.html" %}

{% block title %}
  {{ title }}
{% endblock %}

{% block body %}
<!-- DASH -->
<div id="dashboard" class="section">
</div>

<!-- EVO -->
<div id="evolution" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_evolution_month" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_evolution_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_expenses_by_categ_month" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_incomes_by_categ_month" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_expenses_by_categ_year" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_incomes_by_categ_year" class="plot" style="height: 600px"></div>
  </div>
</div>

<!-- COMP -->
<div id="comparison" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_incomes" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_expenses" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_EBIT" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_liquid" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- PIE -->
<div id="pies" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="PIE_expenses_last_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="PIE_incomes_last_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="PIE_expenses_all" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="PIE_incomes_all" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- LIQ -->
<div id="liquid" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="LIQ_evolution" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="LIQ_vs_expenses" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- INV -->
<div id="investments" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_worth_evolution" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_invest_evolution" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_performance_by_type" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_worth_by_type" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- FIRE -->
<div id="fire" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_savings_ratio_month" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_savings_ratio_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_survivial_rate" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_passive_income_vs_expenses" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_total_month_survival" class="plot" style="height: 450px"></div>
  </div>
</div>
{% endblock %}


{% block plots %}
<script>

  // SHARED INFO
  var axe_no_title = {title: {text: null}}
  var options_maker_enabled = {series: {marker: {enabled: false}}}
  var options_maker_enabled_stacked = {
    series: {
      marker: {enabled: false},
      stacking: 'normal',
    }
  }

  // EVOLUTION SECTION
  Highcharts.chart('EVO_evolution_month', {
    title: {
      text: 'Month evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    series: [
      {% for name in ["Incomes", "Expenses", "EBIT"] %}{
        name: "{{ name }}",
        color: "{{ colors[name] }}",
        data: [{% for mdate, value in month[name].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_evolution_year', {
    title: {
      text: 'Year evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    series: [
      {% for name in ["Incomes", "Expenses", "EBIT"] %}{
        name: "{{ name }}",
        color: "{{ colors[name] }}",
        data: [{% for mdate, value in year[name].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_expenses_by_categ_month', {
    title: {
      text: 'Expenses evolution by category and month'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Expenses"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Expenses_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_incomes_by_categ_month', {
    title: {
      text: 'Incomes evolution by category and month'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Incomes"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Incomes_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_expenses_by_categ_year', {
    title: {
      text: 'Expenses evolution by category and year'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in year["Expenses"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in year["Expenses_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_incomes_by_categ_year', {
    title: {
      text: 'Incomes evolution by category and year'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in year["Incomes"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in year["Incomes_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });

  // COMPARISON SECTION
  Highcharts.chart('COMP_incomes', {title: {text: 'Expenses comparison'},});
  Highcharts.chart('COMP_expenses', {title: {text: 'Incomes comparison'},});
  Highcharts.chart('COMP_EBIT', {title: {text: 'EBIT comparison'},});
  Highcharts.chart('COMP_liquid', {title: {text: 'Liquid comparison'},});

  // PIES SECTION
  Highcharts.chart('PIE_expenses_last_year', {title: {text: 'Expenses last year'},});
  Highcharts.chart('PIE_incomes_last_year', {title: {text: 'Incomes last year'},});
  Highcharts.chart('PIE_expenses_all', {title: {text: 'Expenses all time'},});
  Highcharts.chart('PIE_incomes_all', {title: {text: 'Incomes all time'},});

  // LIQUID SECTION
  Highcharts.chart('LIQ_evolution', {
    title: {
      text: 'Liquid evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["liquid"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["liquid_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['liquid_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('LIQ_vs_expenses', {
    title: {
      text: 'Liquid vs Expenses'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    series: [
      {% for name in ["Expenses", "liquid"] %}{
        name: "{{ name.title() }}",
        color: "{{ colors[name] }}",
        data: [{% for mdate, value in month[name].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
      {
        name: "Minimum liquid recomended",
        color: "{{ colors['liquid_min_rec'] }}",
        data: [{% for mdate, value in month['Expenses'].items() %}
          [Date.parse("{{ mdate }}"), {{ 3*value }}], {% endfor %}
        ]
      },
      {
        name: "Liquid recomended",
        color: "{{ colors['liquid_rec'] }}",
        data: [{% for mdate, value in month['Expenses'].items() %}
          [Date.parse("{{ mdate }}"), {{ 6*value }}], {% endfor %}
        ]
      }
    ],
  });

  // INVESTMENTS SECTION
  Highcharts.chart('INV_worth_evolution', {title: {text: 'Worth evolution'},});
  Highcharts.chart('INV_invest_evolution', {title: {text: 'IInvested evolution'},});
  Highcharts.chart('INV_performance_by_type', {title: {text: 'Performance by type'},});
  Highcharts.chart('INV_worth_by_type', {title: {text: 'Worth by type'},});

  // FIRE SECTION
  Highcharts.chart('FIRE_savings_ratio_month', {title: {text: 'Savings ratio by month'},});
  Highcharts.chart('FIRE_savings_ratio_year', {title: {text: 'Savings ratio by year'},});
  Highcharts.chart('FIRE_survivial_rate', {
    title: {
      text: 'Survival months with current liquid'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    series: [
      {
        name: "Months",
        color: "{{ colors['liquid'] }}",
        data: [{% for mdate in month['Expenses'].keys() %}
          [Date.parse("{{ mdate }}"), {{ month['liquid'][mdate] / month['Expenses'][mdate] }}], {% endfor %}
        ]
      },
      {
        name: "Minimum liquid recomended",
        color: "{{ colors['liquid_min_rec'] }}",
        data: [{% for mdate in month['Expenses'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 3 }}], {% endfor %}
        ]
      },
      {
        name: "Liquid recomended",
        color: "{{ colors['liquid_rec'] }}",
        data: [{% for mdate in month['Expenses'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 6 }}], {% endfor %}
        ]
      }
    ],
  });
  Highcharts.chart('FIRE_passive_income_vs_expenses', {title: {text: 'Passive income vs Expenses'},});
  Highcharts.chart('FIRE_total_month_survival', {title: {text: 'Total months survival'},});
</script>
{% endblock %}
