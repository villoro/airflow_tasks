{% extends "base.html" %}

{% block title %}
  {{ title }}
{% endblock %}

{% block body %}
<!-- DASH -->
<div id="dashboard" class="section w3-center">
  <h1>{{ mdate }} Report</h1>
  <div class="mgrid">
    <div class="w3-card w3-round" style="background-color: {{ colors['Expenses'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">Expenses</h3>
      <h1>{{ dash["Expenses"] }} €</h1>
    </div>
    <div class="w3-card w3-round" style="background-color: {{ colors['Incomes'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">Incomes</h3>
      <h1>{{ dash["Incomes"] }} €</h1>
    </div>
    <div class="w3-card w3-round" style="background-color: {{ colors['EBIT'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">EBIT</h3>
      <h1>{{ dash["EBIT"] }} €</h1>
    </div>
    <div class="w3-card w3-round" style="background-color: {{ colors['Liquid'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">Liquid</h3>
      <h1>{{ dash["Liquid"] }} €</h1>
    </div>
    <div class="w3-card w3-round" style="background-color: {{ colors['Worth'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">Worth</h3>
      <h1>{{ dash["Worth"] }} €</h1>
    </div>
    <div class="w3-card w3-round" style="background-color: {{ colors['Survival'] }}; color:white;">
      <h3 style="margin-bottom: -16px;">Total Worth</h3>
      <h1>{{ dash["Total_worth"] }} €</h1>
    </div>
  </div>
</div>

<!-- EVO -->
<div id="evolution" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_evolution_month" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_evolution_month_12m" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_evolution_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_expenses_by_categ_month" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_incomes_by_categ_month" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_expenses_by_categ_year" class="plot" style="height: 600px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="EVO_incomes_by_categ_year" class="plot" style="height: 600px"></div>
  </div>
</div>

<!-- COMP -->
<div id="comparison" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_incomes" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_expenses" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_EBIT" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="COMP_liquid" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- PIE -->
<div id="pies" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <h3>Expenses</h3>
    <div id="PIE_expenses_last_1m" class="plot" style="height: 180px"></div>
    <div id="PIE_expenses_last_12m" class="plot" style="height: 100px"></div>
    <div id="PIE_expenses_all" class="plot" style="height: 100px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <h3>Incomes</h3>
    <div id="PIE_incomes_last_1m" class="plot" style="height: 180px"></div>
    <div id="PIE_incomes_last_12m" class="plot" style="height: 100px"></div>
    <div id="PIE_incomes_all" class="plot" style="height: 100px"></div>
  </div>
</div>

<!-- LIQ -->
<div id="liquid" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="LIQ_evolution" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="LIQ_vs_expenses" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- INV -->
<div id="investments" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_worth_vs_invest" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_worth_evolution" class="plot" style="height: 450px"></div>
    <div id="INV_invest_evolution" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_performance_by_type" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="INV_worth_by_type" class="plot" style="height: 450px"></div>
  </div>
</div>

<!-- FIRE -->
<div id="fire" class="section">
  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_savings_ratio_month" class="plot" style="height: 450px"></div>
    <div id="FIRE_savings_ratio_year" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_survivial_rate" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_passive_income_vs_expenses" class="plot" style="height: 450px"></div>
  </div>

  <div class="w3-card w3-round w3-center w3-white elem">
    <div id="FIRE_total_years_survival" class="plot" style="height: 450px"></div>
  </div>
</div>
{% endblock %}


{% block plots %}
<script>

  // SHARED INFO
  var axe_no_title = {title: {text: null}}
  var options_maker_enabled = {
    series: {
      marker: {enabled: false},
      stickyTracking: false
    }
  }
  var options_maker_enabled_stacked = {
    series: {
      marker: {enabled: false},
      stickyTracking: false,
      stacking: 'normal',
    }
  }

  // EVOLUTION SECTION
  Highcharts.chart('EVO_evolution_month', {
    title: {
      text: 'Month evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for name in ["EBIT", "Incomes", "Expenses"] %}{
        name: "{{ name }}",
        color: "{{ colors[name] }}",
        data: [{% for mdate, value in month[name].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_evolution_month_12m', {
    title: {
      text: 'Month evolution (12 months MA)'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for name in ["EBIT", "Incomes", "Expenses"] %}
      {
        name: "{{ name }}",
        color: "{{ colors[name] }}",
        data: [{% for mdate, value in month[name + "_12m"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_evolution_year', {
    title: {
      text: 'Year evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    series: [
      {% for name in ["Incomes", "Expenses", "EBIT"] %}{
        name: "{{ name }}",
        color: "{{ colors[name] }}",
        type: 'column',
        data: [{% for mdate, value in year[name].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_expenses_by_categ_month', {
    title: {
      text: 'Expenses evolution by category and month'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Expenses"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Expenses_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_incomes_by_categ_month', {
    title: {
      text: 'Incomes evolution by category and month'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Incomes"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Incomes_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_expenses_by_categ_year', {
    title: {
      text: 'Expenses evolution by category and year'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in year["Expenses"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in year["Expenses_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('EVO_incomes_by_categ_year', {
    title: {
      text: 'Incomes evolution by category and year'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in year["Incomes"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in year["Incomes_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });

  // COMPARISON SECTION
  Highcharts.chart('COMP_incomes', {
    title: {text: 'Incomes comparison (12 months MA)'},
    xAxis: {
      title: {text: "Months"},
      type: 'category'
    },
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for y, data in comp["Incomes"].items() %}{
        name: "{{ y }}",
        color: "{{ colors['comp']['Incomes'][y]['color'] }}",
        lineWidth: {{ colors['comp']['Incomes'][y]['size'] }},
        data: [{% for x, value in data.items() %}
          [{{ x }}, {% if value is number %}{{ value }}{% else %}null{% endif %}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('COMP_expenses', {
    title: {text: 'Expenses comparison (12 months MA)'},
    xAxis: {
      title: {text: "Months"},
      type: 'category'
    },
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for y, data in comp["Expenses"].items() %}{
        name: "{{ y }}",
        color: "{{ colors['comp']['Expenses'][y]['color'] }}",
        lineWidth: {{ colors['comp']['Expenses'][y]['size'] }},
        data: [{% for x, value in data.items() %}
          [{{ x }}, {% if value is number %}{{ value }}{% else %}null{% endif %}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('COMP_EBIT', {
    title: {text: 'EBIT comparison (12 months MA)'},
    xAxis: {
      title: {text: "Months"},
      type: 'category'
    },
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for y, data in comp["EBIT"].items() %}{
        name: "{{ y }}",
        color: "{{ colors['comp']['EBIT'][y]['color'] }}",
        lineWidth: {{ colors['comp']['EBIT'][y]['size'] }},
        data: [{% for x, value in data.items() %}
          [{{ x }}, {% if value is number %}{{ value }}{% else %}null{% endif %}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('COMP_liquid', {
    title: {text: 'Liquid comparison (3 months EWM)'},
    xAxis: {
      title: {text: "Months"},
      type: 'category'
    },
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {% for y, data in comp["Liquid"].items() %}{
        name: "{{ y }}",
        color: "{{ colors['comp']['Liquid'][y]['color'] }}",
        lineWidth: {{ colors['comp']['Liquid'][y]['size'] }},
        data: [{% for x, value in data.items() %}
          [{{ x }}, {% if value is number %}{{ value }}{% else %}null{% endif %}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });

  // PIES SECTION
  pie_tooltip = {
    formatter: function () {
      return "<b>" + this.series.name + ":</b> " + this.percentage.toFixed(2) + "% (" + this.y + " €)";
    }
  }
  Highcharts.chart('PIE_expenses_last_1m', {
    title: {text: ""},
    xAxis: {categories: ["Last month"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    series: [
      {% for name, value in pies["Expenses"]["last_1m"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });
  Highcharts.chart('PIE_expenses_last_12m', {
    title: {text: ""},
    xAxis: {categories: ["Last year"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    legend: {enabled: false},
    series: [
      {% for name, value in pies["Expenses"]["last_12m"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });
  Highcharts.chart('PIE_expenses_all', {
    title: {text: ""},
    xAxis: {categories: ["All time"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    legend: {enabled: false},
    series: [
      {% for name, value in pies["Expenses"]["all"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Expenses_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });
  Highcharts.chart('PIE_incomes_last_1m', {
    title: {text: ""},
    xAxis: {categories: ["Last month"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    series: [
      {% for name, value in pies["Incomes"]["last_1m"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });
  Highcharts.chart('PIE_incomes_last_12m', {
    title: {text: ""},
    xAxis: {categories: ["Last year"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    legend: {enabled: false},
    series: [
      {% for name, value in pies["Incomes"]["last_12m"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });
  Highcharts.chart('PIE_incomes_all', {
    title: {text: ""},
    xAxis: {categories: ["All time"]},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "x", type: "bar"},
    tooltip: pie_tooltip,
    legend: {enabled: false},
    series: [
      {% for name, value in pies["Incomes"]["all"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Incomes_categ'][name] }}",
        data: [{{ value }}],
      }, {% endfor %}
    ],
  });

  // LIQUID SECTION
  Highcharts.chart('LIQ_evolution', {
    title: {
      text: 'Liquid evolution'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Liquid"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Liquid_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Liquid_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });
  Highcharts.chart('LIQ_vs_expenses', {
    title: {
      text: 'Liquid vs Expenses'
    },
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Expenses 12m MA",
        color: "{{ colors['Expenses'] }}",
        data: [{% for mdate, value in month["Expenses_12m"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
      {
        name: "Liquid",
        color: "{{ colors['Liquid_dim'] }}",
        dashStyle: 'shortdot',
        visible: false,
        data: [{% for mdate, value in month["Liquid"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
      {
        name: "Liquid 6m EWM",
        color: "{{ colors['Liquid'] }}",
        data: [{% for mdate, value in month["Liquid_6m_e"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
      {
        name: "Minimum liquid recomended",
        color: "{{ colors['Min_value'] }}",
        data: [{% for mdate, value in month['Expenses_12m'].items() %}
          [Date.parse("{{ mdate }}"), {{ 3*value | int }}], {% endfor %}
        ]
      },
      {
        name: "Liquid recomended",
        color: "{{ colors['Recomended_value'] }}",
        data: [{% for mdate, value in month['Expenses_12m'].items() %}
          [Date.parse("{{ mdate }}"), {{ 6*value | int }}], {% endfor %}
        ]
      }
    ],
  });

  // INVESTMENTS SECTION
  Highcharts.chart('INV_worth_vs_invest', {
    title: {text: 'Worth vs Invested'},
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total Invested",
        color: "{{ colors['Invest'] }}",
        dashStyle: 'shortdot',
        data: [{% for mdate, value in month["Invest"].items() %}
          [Date.parse("{{ mdate }}"), {{ value + month["Liquid"][mdate] }}], {% endfor %}
        ]
      },
      {
        name: "Total Worth",
        color: "{{ colors['Worth'] }}",
        data: [{% for mdate, value in month["Worth"].items() %}
          [Date.parse("{{ mdate }}"), {{ value + month["Liquid"][mdate] }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('INV_worth_evolution', {
    title: {text: 'Worth evolution'},
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Worth"].items() %}
          [Date.parse("{{ mdate }}"), {{ value + month["Liquid"][mdate] }}], {% endfor %}
        ]
      },
      {
        name: "Worth",
        color: "{{ colors['Worth'] }}",
        type: 'column',
        data: [{% for mdate, value in month['Worth'].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
      {
        name: "Liquid",
        color: "{{ colors['Liquid'] }}",
        type: 'column',
        data: [{% for mdate, value in month["Liquid"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('INV_invest_evolution', {
    title: {text: 'Invested evolution'},
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Invest"].items() %}
          [Date.parse("{{ mdate }}"), {{ value + month["Liquid"][mdate] }}], {% endfor %}
        ]
      },
      {
        name: "Invested",
        type: 'column',
        color: "{{ colors['Invest'] }}",
        data: [{% for mdate, value in month['Invest'].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
       {
        name: "Liquid",
        color: "{{ colors['Liquid'] }}",
        type: 'column',
        data: [{% for mdate, value in month["Liquid"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('INV_performance_by_type', {title: {text: 'Performance by type'},});
  Highcharts.chart('INV_worth_by_type', {
    title: {text: 'Worth by type'},
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled_stacked,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Total",
        color: "#000000",
        data: [{% for mdate, value in month["Worth"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% for name, data in month["Worth_by_groups"].items() %}{
        name: "{{ name }}",
        color: "{{ colors['Investment_categ'][name] }}",
        type: 'column',
        data: [{% for mdate, value in data.items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      }, {% endfor %}
    ],
  });

  // FIRE SECTION
  Highcharts.chart('FIRE_savings_ratio_month', {
    title: {text: 'Savings ratio by month'},
    xAxis: {type: 'datetime'},
    yAxis: {
      title: {text: null},
      plotLines: [
        {
          color: "{{ colors['Recomended_value'] }}",
          value: 1,
          label: {
              align: 'left',
              text: 'Max Savings Ratio',
          },
        },
      ],
    },
    plotOptions: options_maker_enabled,
    chart: {zoomType: "x"},
    series: [
      {
        name: "Savings ratio",
        color: "{{ colors['Savings_dim'] }}",
        dashStyle: 'shortdot',
        data: [{% for mdate, value in month["Savings"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
       {
        name: "12 months MA",
        color: "{{ colors['Savings'] }}",
        data: [{% for mdate, value in month["Savings_12m"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('FIRE_savings_ratio_year', {
    title: {text: 'Savings ratio by year'},
    xAxis: {type: 'datetime'},
    yAxis: {
      title: {text: null},
      plotLines: [
        {
          color: "{{ colors['Recomended_value'] }}",
          value: 1,
          label: {
              align: 'left',
              text: 'Max Savings Ratio',
          },
        },
      ],
    },
    plotOptions: options_maker_enabled,
    series: [
      {
        name: "Savings ratio",
        color: "{{ colors['Savings'] }}",
        type: 'column',
        data: [{% for mdate, value in year["Savings"].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('FIRE_survivial_rate', {
    title: {
      text: 'Survival months (Liquid / Expenses)'
    },
    xAxis: {type: 'datetime'},
    yAxis: {
      title: {text: null},
      plotLines: [
        {
          color: "{{ colors['Expenses'] }}",
          dashStyle: 'shortdot',
          value: 24,
          label: {
              align: 'left',
              text: '2 years',
          },
        },
        {
          color: "{{ colors['Max_value'] }}",
          dashStyle: 'shortdashdot',
          value: 12,
          label: {
              align: 'left',
              text: '1 year',
          },
        },
        {
          color: "{{ colors['Recomended_value'] }}",
          value: 6,
          label: {
              align: 'left',
              text: 'Liquid recomended (6 months)',
          },
        },
        {
          color: "{{ colors['Min_value'] }}",
          value: 3,
          label: {
              align: 'left',
              text: 'Minimum liquid recomended (3 months)',
          },
        }
      ],
    },
    plotOptions: options_maker_enabled,
    chart: {zoomType: "x"},
    series: [
      {
        name: "Months",
        color: "{{ colors['Liquid_dim'] }}",
        dashStyle: 'shortdot',
        visible: false,
        data: [{% for mdate in month['Expenses'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 
            (month['Liquid'][mdate] / month['Expenses'][mdate]) | round(2)
          }}], {% endfor %}
        ]
      },
      {
        name: "Months 6m EWM / 12m MA",
        color: "{{ colors['Liquid'] }}",
        data: [{% for mdate in month['Expenses'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 
            (month['Liquid_6m_e'][mdate] / month['Expenses_12m'][mdate]) | round(2)
          }}], {% endfor %}
        ]
      }
    ],
  });
  Highcharts.chart('FIRE_passive_income_vs_expenses', {
    title: {text: 'Passive income vs Expenses'},
    xAxis: {type: 'datetime'},
    yAxis: axe_no_title,
    plotOptions: options_maker_enabled,
    chart: {zoomType: "xy"},
    series: [
      {
        name: "Passive Income",
        color: "{{ colors['Incomes_passive'] }}",
        data: [{% for mdate, value in month['Worth'].items() %}
          [Date.parse("{{ mdate }}"), {{ (value/300) | round(2) }}], {% endfor %}
        ]
      },
      {
        name: "Expenses",
        color: "{{ colors['Expenses_dim'] }}",
        dashStyle: 'shortdot',
        visible: false,
        data: [{% for mdate, value in month['Expenses'].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
      {
        name: "Expenses 6m EWM",
        color: "{{ colors['Expenses'] }}",
        data: [{% for mdate, value in month['Expenses_6m_e'].items() %}
          [Date.parse("{{ mdate }}"), {{ value }}], {% endfor %}
        ]
      },
    ],
  });
  Highcharts.chart('FIRE_total_years_survival', {
    title: {text: 'Doomsday years (Assets / Expenses)'},
    xAxis: {type: 'datetime'},
    yAxis: {
      title: {text: null},
      plotLines: [
        {
          color: "{{ colors['Recomended_value'] }}",
          value: 30,
          label: {
              align: 'left',
              text: 'FIRE 3%',
          },
        },
        {
          color: "{{ colors['Min_value'] }}",
          value: 25,
          label: {
              align: 'left',
              text: 'FIRE 4%',
          },
        }
      ],
    },
    plotOptions: options_maker_enabled,
    chart: {zoomType: "x"},
    series: [
      {
        name: "Years",
        color: "{{ colors['Survival_dim'] }}",
        dashStyle: 'shortdot',
        data: [{% for mdate in month['Worth'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 
            (
              ( month['Worth'][mdate] + month['Liquid'][mdate] ) / 
              (12*month['Expenses'][mdate])
            ) | round(2)
          }}], {% endfor %}
        ]
      },
      {
        name: "Years 6m EWM",
        color: "{{ colors['Survival'] }}",
        data: [{% for mdate in month['Worth'].keys() %}
          [Date.parse("{{ mdate }}"), {{ 
            (
              ( month['Worth'][mdate] + month['Liquid_6m_e'][mdate] ) / 
              (12*month['Expenses_6m_e'][mdate])
            ) | round(2)
          }}], {% endfor %}
        ]
      },
    ],
  });
</script>
{% endblock %}
